# Monitore Linux and Unix FS usage and send alarm messages to SLACK.

Table of contents
=================

<!--ts-->
   * [Prerequisites](#prerequisites)
   * [Installing](#installing)
   * [How to use bdh in manually mode](#how-to-use-bdh-in-manually-mode)
   * [How to use bdh in automatic mode](#how-to-use-bdh-in-automatic-mode)
   * [Log file](#log-file)
   * [Author](#author)
<!--te-->

### [Prerequisites](#prerequisites)

- BASH 4.1 (or higher)
- Internet connection (necessary to send alert messages to SLACK)
- Signed up to Slack and install Incoming Webhook APP. Check it out [here](https://api.slack.com/incoming-webhooks)  

### [Installing](#installing)

- Download bdh [zip file](https://github.com/macedojleo/BDH/zipball/master) or in tar format [tar file](https://github.com/macedojleo/BDH/tarball/master).

- Unzip it.

- Move the BDH file to any PATH directory (use echo $PATH to see them).

- Check if everything is working well using the command ```$ bdh -h```

### [Defining thresholds](#thresholds)

- Open the BDH file with a text editor and edit the following lines to setting up the thresholds:

 * Def_major="70";
 * Def_critical="85";
 * Def_urgent="95";

### [Use BDH in visual mode](#manually)

Use **BDH** with one of these options [-k |-K (Kbytes), -m | -M (Mbytes), or -g | -G (Gbytes)] to show the current FS usage.

```$ bdh -g or $ bdh -G #Gb Format.```
```$ bdh -m or $ bdh -M #Mb Format.```
```$ bdh -k or $ bdh -K #Kb Format.```
	
- The **NORMAL** usage is showing as white.
- The **MAJOR** usage is showing as yellow.
- The **CRITICAL** usage is showing as red.
- The **URGENT** usage is showing flashing.

![Sample](/docs/sample.gif)

## [BDH - Deamon Mode](#automatic)

Use BDH with -d option 

![SlackMessages](/docs/SlackExampleMessages.png)
 

### Starting BDH in deamon mode

To start the BDH as a daemon process, you should use **- d** parameter and set the interval time (in seconds) which the process will check the disks usage:

	$ bdh -d or bdh -D (interval in seconds) #eg. bdg -d 60 -> bdh will check the disks usage every minute (60 seconds).

To STOP BDH process use **bdh -s** or **bdh -S**:

	# Stopping BDH deamon process
	$ bdh -s 
	

### Example of slack messages sent by BDH

- **CRITICAL** alarm message is identified by a :bomb: icon:

![SlackCritical](/docs/slackCriticalMessage.png)



- **URGENT** alarm message  is identified by a :fire: icon:

![SlackUrgent](/docs/slackUrgentMessage.png)



## [Log file](#log)

Log files are generated by BDH process only in deamon mode with the name bdh_<timestamp-mmddyyyy>.log. See in the next session [how to configure bdh](#configure) to set the directory path where the log files will be stored.
	
The log file prints information such as START and STOP BDH process besides piece of information about alarm messages sent by the BDH.

	START  |  02/18/19-23:56:33 | Starting process in Deamon mode | PID:  9282 INTERVAL: 3600 | logFile: /tmp/bdh_021819.log
	INFO  |  02/19/19-13:33:56 | FS: tmpfs | Used: 32 kb | Free: 782368 kb | 1%
	CRITICAL  |  02/19/19-15:23:09 | FS: /dev/loop5 | Used: 80 kb | Free: 20 kb | 80%
	URGENT  |  02/19/19-15:23:09 | FS: /dev/loop8 | Used: 100 kb | Free: 0 kb | 100%
	STOP  |  02/19/19-15:23:10 | Process stopped by LEONARDO MACEDO 
	

## [How to configure bdh](#configure)

### [Customize Thresholds]
To customize FS usage thresholds, open bdh script using a text editor your choice and replace the lines below by the values you prefer Remember: All these values were set up using percent format. (e.g. the number "70" means "70%" of FS usage). 

	#set FS usage thresholds here:                                   

	Def_major="70"; #Set value for MAJOR FS usage.
	Def_critical="85"; #Set value for CRITICAL FS usage.
	Def_urgent="95"; #Set value for URGENT FS usage.
	
*PS: This setting will affect both: Manual and Automatic alerts.

### [Configure Webhook App for Slack]
To configure WebHook to allow Slack receives HTTP REQUESTS sent by bdh process, change the variable value below setting URL Webhook you got when install APP using the tutorial at [prerequisites topic](#prerequisites).

	SlackWebHook="INSERT YOUR WEBHOOK URL HERE"

### [Change log Dir]
To change the directory where bdh will write the process log file, Open the bdh script using a text editor you prefer, locate, and change the value of variable logdir as showing below:

	#Change here logdir (log will be generated only in daemon mode).
	logdir="/tmp"

## [Author](#author)

[Leonardo Macedo](https://www.linkedin.com/in/leonardo-macedo-96026a94/) - *MSc Software Engineering, Unix/Linux Sysadm, IT Consultant, DevOps Operations, Continuos Integration, Python, and Shell script*

<hr>
<p align="center"><a href="https://www.linkedin.com/in/leonardo-macedo-96026a94/">linkedin</a> | <a href="mailto:macedojleo@gmail.com">mail</a> | <a href="https://github.com/macedojleo">github</a></p>
